// -------------------------------------------------------------
// กำหนดขาที่ใช้ควบคุมมอเตอร์ A
// enA = ขา PWM สำหรับปรับรอบ
// in1, in2 = ขาสั่งทิศทางหมุน
// -------------------------------------------------------------
int enA = 13;
int in1 = 12;
int in2 = 14;


// -------------------------------------------------------------
// ฟังก์ชันสาธิตการควบคุมทิศทางหมุนของมอเตอร์
// หมุนตามเข็ม 2 วินาที → หมุนย้อนเข็ม 2 วินาที → หยุด
// -------------------------------------------------------------
void directionControl() {

  // enA = HIGH จะให้ความเร็วสูงสุด (ไม่ได้ใช้ PWM)
  digitalWrite(enA, HIGH);

  // หมุนไปข้างหน้า (in1=HIGH, in2=LOW)
  digitalWrite(in1, HIGH);
  digitalWrite(in2, LOW);
  delay(2000);

  // หมุนกลับด้าน (in1=LOW, in2=HIGH)
  digitalWrite(in1, LOW);
  digitalWrite(in2, HIGH);
  delay(2000);

  // หยุดมอเตอร์
  digitalWrite(in1, LOW);
  digitalWrite(in2, LOW);
}


// -------------------------------------------------------------
// ฟังก์ชันสาธิตการควบคุมความเร็วของมอเตอร์ด้วย PWM
// เร่งความเร็ว 0 → 255 แล้วลดกลับ 255 → 0
// -------------------------------------------------------------
void speedControl() {

  // ตั้งทิศทางมอเตอร์ก่อน (in1=LOW, in2=HIGH)
  digitalWrite(in1, LOW);
  digitalWrite(in2, HIGH);

  // เร่งความเร็วทีละขั้น จาก 0 ถึง 255
  for (int i = 0; i < 256; i++) {
    analogWrite(enA, i);  // ปรับความเร็ว (PWM)
    delay(20);
  }

  // ลดความเร็วจาก 255 ลงมา 0
  for (int i = 255; i >= 0; --i) {
    analogWrite(enA, i);  // ลด PWM ลงทีละระดับ
    delay(20);
  }

  // หยุดมอเตอร์
  digitalWrite(in1, LOW);
  digitalWrite(in2, LOW);
}

void setup() {
  Serial.begin(115200);

  // ตั้งขามอเตอร์ให้เป็น OUTPUT
  pinMode(enA, OUTPUT);
  pinMode(in1, OUTPUT);
  pinMode(in2, OUTPUT);

  // ปิดมอเตอร์ตอนเริ่มต้น
  digitalWrite(in1, LOW);
  digitalWrite(in2, LOW);
}

// -------------------------------------------------------------
// ทดสอบหมุน ↔ หมุนกลับ → ควบคุมความเร็ว
// -------------------------------------------------------------
void loop() {

  directionControl(); // สาธิตทิศทางหมุน
  delay(1000);

  speedControl();     // สาธิตปรับความเร็ว
  delay(1000);
}
